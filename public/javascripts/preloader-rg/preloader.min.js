!function(e,o){"function"==typeof define&&define.amd?define(o):"object"==typeof exports?module.exports=o():e.preloader=o}(this,function(){"use strict";var e={};e.defaults={debug:!1,filesToLoad:[],allowed:["jpg","jpeg","png","gif"],loadDelay:0,beforeLoad:function(){},afterLoad:function(){},onUpdate:function(){}},e.regex={src:/src=\"(.*?)\"/gm,url:/url\((.*?)\)/gm,css:/<link href=\"(.*?)\"/gm},e.html=String(document.querySelector("html").innerHTML);var o=[],n=function(o){try{i(),e.options="object"==typeof o?t(o):e.defaults,e.options.filesToLoad.length?(e.filelist=e.options.filesToLoad.filter(function(o,n){return e.options.filesToLoad.indexOf(o)==n}),l()):f(a)}catch(n){console.log(n)}},t=function(o){for(var n in o)if("undefined"!=typeof e.defaults[n])e.defaults[n]=o[n];else if(e.defaults.debug)throw"There's no option called: '"+n+"'";return e.defaults},i=function(){e.promise="undefined"!=typeof Promise&&-1!==Promise.toString().indexOf("[native code]")?!0:!1},r=function(o){var n=/([^.;+_]+)$/.exec(o),t=n&&n[1];return e.options.allowed.indexOf(t)>-1?!0:!1},f=function(o){for(var n,t=[];n=e.regex.src.exec(e.html);)r(n[1])&&t.push(n[1]);for(;n=e.regex.url.exec(e.html);)n=n[1].replace(/[']/g,""),r(n)&&t.push(n);"function"==typeof o&&o()},a=function(){for(var o,n=[];o=e.regex.css.exec(e.html);){var t=new XMLHttpRequest;t.open("GET",o[1],!0),t.send(),t.onreadystatechange=function(){if(4==t.readyState&&200==t.status){for(;o=e.regex.url.exec(t.responseText);)o=o[1].replace(/[']/g,""),r(o)&&n.push(o);e.filelist=n.filter(function(e,o){return n.indexOf(e)==o}),l()}}}},l=function(){"function"==typeof e.options.beforeLoad&&e.options.beforeLoad(),s()},s=function(){var o=0;if(e.promise){var n=e.filelist.map(function(e){return u(e).then(function(){o++,c(o)},function(){o++,c(o)})});Promise.all(n).then(function(){e.complete=!0,p()})}else{e.loadedImages=0,d();for(var t=e.filelist.length-1;t>=0;t--)u(e.filelist[t])}},u=function(o){if(e.promise)return new Promise(function(e,n){var t=new Image;t.src=o,t.onload=function(){e()},t.onerror=function(){n("Can't find: "+o)}});var n=new Image;n.src=o,n.onload=function(){e.loadedImages++,c(e.loadedImages)},n.onerror=function(){e.loadedImages++,c(e.loadedImages)}},c=function(o){var n=Number(parseFloat(o/e.filelist.length*100).toFixed(2));e.options.onUpdate(n)},d=function(){var o=setInterval(function(){e.loadedImages===e.filelist.length&&(e.complete=!0,p(),clearInterval(o))},50)},p=function(){setTimeout(function(){e.options.afterLoad();for(var n=o.length-1;n>=0;n--)o[n]()},e.options.loadDelay)},g=function(n){e.complete?n():"function"==typeof n&&o.push(n)};return{preloader:e,init:n,onLoad:g}}());
